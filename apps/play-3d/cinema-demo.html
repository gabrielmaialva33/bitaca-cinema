<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Bitaca Virtual Cinema - Demo</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Barlow', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0A0A0A;
            color: white;
            overflow: hidden;
        }

        #play3d-canvas {
            display: block;
            width: 100%;
            height: 100vh;
        }

        /* Loading screen */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #0A0A0A 0%, #1A1A1A 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }

        #loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-logo {
            font-size: 48px;
            margin-bottom: 30px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.05);
            }
        }

        .loading-text {
            font-size: 18px;
            margin-bottom: 20px;
            color: #999;
        }

        .loading-bar {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #C41E3A, #FF6B6B);
            width: 0%;
            transition: width 0.3s;
        }

        /* Top bar with controls */
        #top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.8), transparent);
            z-index: 100;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: #C41E3A;
        }

        .top-controls {
            display: flex;
            gap: 15px;
        }

        .btn {
            background: rgba(196, 30, 58, 0.8);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Barlow', sans-serif;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn:hover {
            background: rgba(196, 30, 58, 1);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Info panel */
        #info-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 12px;
            color: #999;
            z-index: 50;
            max-width: 300px;
        }

        #info-panel h4 {
            color: #C41E3A;
            margin-bottom: 10px;
        }

        #info-panel ul {
            list-style: none;
            padding: 0;
        }

        #info-panel li {
            padding: 5px 0;
        }

        #info-panel kbd {
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            color: white;
        }

        /* Stats */
        #stats {
            position: fixed;
            top: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            z-index: 50;
        }

        .stat-label {
            color: #C41E3A;
            font-weight: bold;
        }
    </style>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
<!-- Canvas -->
<canvas id="play3d-canvas"></canvas>

<!-- Loading Screen -->
<div id="loading-screen">
    <div class="loading-logo">üé¨</div>
    <div class="loading-text" id="loading-text">Carregando Bitaca Virtual Cinema...</div>
    <div class="loading-bar">
        <div class="loading-progress" id="loading-progress"></div>
    </div>
</div>

<!-- Top Bar -->
<div id="top-bar">
    <div class="logo">üé¨ BITACA VIRTUAL CINEMA</div>
    <div class="top-controls">
        <button class="btn" id="btn-show-menu">üìã Produ√ß√µes</button>
        <button class="btn btn-secondary" id="btn-reset-camera">üì∑ Reset Camera</button>
        <button class="btn btn-secondary" id="btn-toggle-stats">üìä Stats</button>
    </div>
</div>

<!-- Info Panel -->
<div id="info-panel">
    <h4>‚å®Ô∏è Controles</h4>
    <ul>
        <li><kbd>Space</kbd> - Play/Pause</li>
        <li><kbd>F</kbd> - Fullscreen</li>
        <li><kbd>M</kbd> - Mute</li>
        <li><kbd>‚Üê/‚Üí</kbd> - Seek ¬±10s</li>
        <li><kbd>‚Üë/‚Üì</kbd> - Volume</li>
        <li><kbd>Mouse</kbd> - Look Around</li>
    </ul>
</div>

<!-- Stats -->
<div id="stats" style="display: none;">
    <div><span class="stat-label">FPS:</span> <span id="fps">0</span></div>
    <div><span class="stat-label">Geometries:</span> <span id="geometries">0</span></div>
    <div><span class="stat-label">Textures:</span> <span id="textures">0</span></div>
    <div><span class="stat-label">Productions:</span> <span id="productions">0</span></div>
</div>

<!-- Import maps for Three.js -->
<script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
</script>

<!-- Load production data -->
<script src="/frontend/assets/js/data.js"></script>

<!-- Main script -->
<script type="module">
    import * as THREE from 'three';
    import {OrbitControls} from 'three/addons/controls/OrbitControls.js';
    import {VirtualCinema} from './assets/js/components/virtual-cinema.js';

    console.log('üöÄ Starting Bitaca Virtual Cinema Demo...');

    class CinemaDemo {
        constructor() {
            this.canvas = document.getElementById('play3d-canvas');
            this.scene = null;
            this.camera = null;
            this.renderer = null;
            this.controls = null;
            this.clock = new THREE.Clock();
            this.virtualCinema = null;

            // Stats
            this.frameCount = 0;
            this.lastTime = Date.now();
            this.fps = 0;

            this.init();
        }

        async init() {
            console.log('üé¨ Initializing demo...');

            // Setup Three.js
            this.setupScene();
            this.setupCamera();
            this.setupRenderer();
            this.setupControls();
            this.setupLights();

            // Load cinema
            await this.loadCinema();

            // Setup UI
            this.setupUI();

            // Window resize
            window.addEventListener('resize', () => this.onWindowResize());

            // Start animation
            this.animate();

            // Hide loading screen
            this.hideLoadingScreen();

            console.log('‚úÖ Demo ready!');
        }

        setupScene() {
            this.scene = new THREE.Scene();
            this.scene.background = new THREE.Color(0x0A0A0A);
            this.scene.fog = new THREE.Fog(0x0A0A0A, 50, 200);
        }

        setupCamera() {
            this.camera = new THREE.PerspectiveCamera(
                75,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            this.camera.position.set(0, 1.6, 4);
        }

        setupRenderer() {
            this.renderer = new THREE.WebGLRenderer({
                canvas: this.canvas,
                antialias: true,
                alpha: false,
                powerPreference: 'high-performance'
            });
            this.renderer.setSize(window.innerWidth, window.innerHeight);
            this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            this.renderer.shadowMap.enabled = true;
            this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            this.renderer.toneMapping = THREE.ACESFilmicToneMapping;
            this.renderer.toneMappingExposure = 1.2;
        }

        setupControls() {
            this.controls = new OrbitControls(this.camera, this.renderer.domElement);
            this.controls.enableDamping = true;
            this.controls.dampingFactor = 0.05;
            this.controls.minDistance = 2;
            this.controls.maxDistance = 20;
            this.controls.target.set(0, 5, -10);
        }

        setupLights() {
            // Ambient light
            const ambient = new THREE.AmbientLight(0xffffff, 0.3);
            this.scene.add(ambient);

            // Directional light
            const directional = new THREE.DirectionalLight(0xffffff, 0.5);
            directional.position.set(10, 20, 10);
            directional.castShadow = true;
            this.scene.add(directional);
        }

        async loadCinema() {
            console.log('üèóÔ∏è Building virtual cinema...');

            this.updateLoadingProgress(30, 'Criando sala de cinema...');

            this.virtualCinema = new VirtualCinema(
                this.scene,
                this.camera,
                this.renderer
            );

            this.updateLoadingProgress(60, 'Carregando produ√ß√µes...');

            await this.virtualCinema.init();

            this.updateLoadingProgress(100, 'Pronto!');

            console.log('‚úÖ Virtual cinema loaded!');
        }

        setupUI() {
            // Show menu button
            document.getElementById('btn-show-menu').addEventListener('click', () => {
                this.virtualCinema.showMenu();
            });

            // Reset camera button
            document.getElementById('btn-reset-camera').addEventListener('click', () => {
                this.virtualCinema.setCameraPosition('cinema');
            });

            // Toggle stats button
            document.getElementById('btn-toggle-stats').addEventListener('click', () => {
                const stats = document.getElementById('stats');
                stats.style.display = stats.style.display === 'none' ? 'block' : 'none';
            });

            // Update stats
            setInterval(() => this.updateStats(), 1000);
        }

        updateLoadingProgress(percent, text) {
            document.getElementById('loading-progress').style.width = `${percent}%`;
            document.getElementById('loading-text').textContent = text;
        }

        hideLoadingScreen() {
            setTimeout(() => {
                document.getElementById('loading-screen').classList.add('hidden');
            }, 500);
        }

        updateStats() {
            document.getElementById('fps').textContent = this.fps.toFixed(0);
            document.getElementById('geometries').textContent =
                this.renderer.info.memory.geometries;
            document.getElementById('textures').textContent =
                this.renderer.info.memory.textures;
            document.getElementById('productions').textContent =
                this.virtualCinema ? this.virtualCinema.productions.length : 0;
        }

        onWindowResize() {
            this.camera.aspect = window.innerWidth / window.innerHeight;
            this.camera.updateProjectionMatrix();
            this.renderer.setSize(window.innerWidth, window.innerHeight);
        }

        animate() {
            requestAnimationFrame(() => this.animate());

            const delta = this.clock.getDelta();

            // Update controls
            this.controls.update();

            // Update cinema
            if (this.virtualCinema) {
                this.virtualCinema.update(delta);
            }

            // Render
            this.renderer.render(this.scene, this.camera);

            // Calculate FPS
            this.frameCount++;
            const now = Date.now();
            if (now - this.lastTime >= 1000) {
                this.fps = this.frameCount;
                this.frameCount = 0;
                this.lastTime = now;
            }
        }
    }

    // Start demo
    window.addEventListener('DOMContentLoaded', () => {
        const demo = new CinemaDemo();
        window.cinemaDemo = demo; // For debugging
    });
</script>
</body>
</html>
