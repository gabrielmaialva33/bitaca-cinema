# Frontend Configuration for www.abitaca.com.br
# Proxy/Mirror to GitHub Pages to save resources
# This file should be placed in /etc/nginx/sites-available/bitaca-www.conf

upstream github_pages {
    server gabrielmaialva33.github.io:443;
    keepalive 32;
}

server {
    listen 80;
    server_name www.abitaca.com.br abitaca.com.br;

    # Logs
    access_log /var/log/nginx/bitaca-www-access.log;
    error_log /var/log/nginx/bitaca-www-error.log;

    # Cloudflare Real IP
    set_real_ip_from 173.245.48.0/20;
    set_real_ip_from 103.21.244.0/22;
    set_real_ip_from 103.22.200.0/22;
    set_real_ip_from 103.31.4.0/22;
    set_real_ip_from 141.101.64.0/18;
    set_real_ip_from 108.162.192.0/18;
    set_real_ip_from 190.93.240.0/20;
    set_real_ip_from 188.114.96.0/20;
    set_real_ip_from 197.234.240.0/22;
    set_real_ip_from 198.41.128.0/17;
    set_real_ip_from 162.158.0.0/15;
    set_real_ip_from 104.16.0.0/13;
    set_real_ip_from 104.24.0.0/14;
    set_real_ip_from 172.64.0.0/13;
    set_real_ip_from 131.0.72.0/22;
    real_ip_header CF-Connecting-IP;

    # Proxy to GitHub Pages
    location / {
        proxy_pass https://gabrielmaialva33.github.io/bitaca-cinema/;
        proxy_ssl_server_name on;
        proxy_ssl_protocols TLSv1.2 TLSv1.3;

        # Headers
        proxy_set_header Host gabrielmaialva33.github.io;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Accept-Encoding "";

        # Hide GitHub Pages headers
        proxy_hide_header X-GitHub-Request-Id;

        # Security headers
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-XSS-Protection "1; mode=block" always;

        # NO CACHE - always fetch fresh content
        proxy_cache_bypass 1;
        proxy_no_cache 1;
        proxy_buffering off;

        # Disable nginx cache
        add_header Cache-Control "no-store, no-cache, must-revalidate" always;
        add_header Pragma "no-cache" always;
        expires -1;

        # Timeouts
        proxy_connect_timeout 10s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }
}